<!DOCTYPE html>
<html>
  <head>
    <title>YouTube 轉換器</title>
    <meta charset="utf-8" />
    <style>
      body {
        font-family: sans-serif;
        padding: 2em;
      }
      input,
      button,
      textarea {
        width: 100%;
        font-size: 1rem;
        margin-top: 0.5em;
      }
      .result-block {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        margin-top: 1em;
      }
      .result-block label {
        font-weight: bold;
        display: inline;
      }
      .result-block a {
        display: inline;
        color: blue;
        text-decoration: underline;
      }
      .result-block textarea {
        flex-basis: 100%;
        margin-top: 0.2em;
      }
    </style>
  </head>
  <body>
    <h2>YouTube 轉換器</h2>
    <div class="result-block">
      <label style="display: inline;">請貼上 YouTube/YouTube Music 連結：</label>
      <input id="yt" placeholder="https://www.youtube.com/watch?v=jNQXAC9IVRw" />
      <button onclick="convert()">轉換</button>
    </div>

    <div class="result-block">
      <label style="display: inline;">Invidious 分享網址：</label>
      <a id="Invidiouslink" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="Invidious" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">Piped 分享網址：</label>
      <a id="NYCPipedlink" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="NYCPiped" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">Piped 分享網址：</label>
      <a id="CALPipedlink" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="CALPiped" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">Piped 分享網址：</label>
      <a id="POLPipedlink" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="POLPiped" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">Hyperpipe 分享網址：</label>
      <a id="NYCHyperpipelink" href="#" target="_blank" style="display: none;">點我前往音樂</a>
      <textarea id="NYCHyperpipe" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">Hyperpipe 分享網址：</label>
      <a id="CALHyperpipelink" href="#" target="_blank" style="display: none;">點我前往音樂</a>
      <textarea id="CALHyperpipe" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">Hyperpipe 分享網址：</label>
      <a id="POLHyperpipelink" href="#" target="_blank" style="display: none;">點我前往音樂</a>
      <textarea id="POLHyperpipe" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">ytify 分享網址：</label>
      <a id="ytifylink" href="#" target="_blank" style="display: none;">點我前往音樂</a>
      <textarea id="ytify" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">m.gjhyss.com 分享網址：</label>
      <a id="link1" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="m.gjhyss.com" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">cinemaphile.com 分享網址：</label>
      <a id="link2" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="cinemaphile.com" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">YMusic 分享網址：</label>
      <a id="link3" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="YMusic" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">AstroTube 分享網址：</label>
      <a id="link4" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="AstroTube" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">最短 YouTube 連結：</label>
      <a id="shortURLlink" href="#" target="_blank" style="display: none;">點我前往影片</a>
      <textarea id="shorturl" rows="1" readonly></textarea>
    </div>

    <div class="result-block">
      <label style="display: inline;">YouTube Music 連結：</label>
      <a id="YTMusiclink" href="#" target="_blank" style="display: none;">點我前往音樂</a>
      <textarea id="YTMusic" rows="1" readonly></textarea>
    </div>

    <script>
      function convert() {
        const input = document.getElementById("yt").value.trim();

        // 改進影片 ID 和清單 ID 的擷取
        const urlObj = new URL(input, "https://youtube.com");
        let vid = null;
        let list = null;

        // 處理 youtu.be 短網址
        if (urlObj.hostname === "youtu.be") {
          const path = urlObj.pathname.replace("/", "");
          if (path === "playlist") {
            list = urlObj.searchParams.get("list");
          } else {
            vid = path;
            list = urlObj.searchParams.get("list");
          }
        } else {
          vid = urlObj.searchParams.get("v") || input.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/)?.[1];
          list = urlObj.searchParams.get("list");
        }

        const services = [
          { id: "Invidious", base: "https://inv.nadeko.net/", mode: "auto", type: "watch", linkId: "Invidiouslink" },
          { id: "NYCPiped", base: "https://nyc1.pi.ggtyler.dev/", mode: "auto", type: "watch", linkId: "NYCPipedlink" },
          { id: "CALPiped", base: "https://cal1.pi.ggtyler.dev/", mode: "auto", type: "watch", linkId: "CALPipedlink" },
          { id: "POLPiped", base: "https://pol1.pi.ggtyler.dev/", mode: "auto", type: "watch", linkId: "POLPipedlink" },
          { id: "NYCHyperpipe", base: "https://nyc1.hp.ggtyler.dev", mode: "auto", type: "watch", linkId: "NYCHyperpipelink" },
          { id: "CALHyperpipe", base: "https://cal1.hp.ggtyler.dev/", mode: "auto", type: "watch", linkId: "CALHyperpipelink" },
          { id: "POLHyperpipe", base: "https://pol1.hp.ggtyler.dev/", mode: "auto", type: "watch", linkId: "POLHyperpipelink" },
          { id: "ytify", base: "https://ytify.pp.ua/", mode: "ytify", linkId: "ytifylink" },
          { id: "m.gjhyss.com", base: "https://m.gjhyss.com/share?v=", mode: "vid", linkId: "link1" },
          { id: "cinemaphile.com", base: "https://cinemaphile.com/watch?v=", mode: "vid", linkId: "link2" },
          { id: "YMusic", base: "https://ymusicapp.com/", mode: "auto", type: "watch", linkId: "link3" },
          { id: "AstroTube", base: "https://at.ggtyler.dev/watch?v=", mode: "vid", linkId: "link4" },
          { id: "shorturl", base: "https://youtu.be/", mode: "vid", linkId: "shortURLlink" },
          { id: "YTMusic", base: "https://music.youtube.com/", mode: "auto", type: "watch", linkId: "YTMusiclink" },
        ];

        if (!vid && !list) {
          services.forEach((s) => {
            document.getElementById(s.id).value = "⚠️ 無法辨識影片或播放清單 ID";
            document.getElementById(s.linkId).style.display = "none";
          });
          return;
        }

        services.forEach((s) => {
          let url = null;

          switch (s.mode) {
            case "vid":
              if (s.id === "shorturl") {
                if (vid && list) {
                  url = `${s.base}${vid}?list=${list}`;
                } else if (vid) {
                  url = `${s.base}${vid}`;
                } else if (list) {
                  url = `https://youtube.com/playlist?list=${list}`;
                }
              } else {
                url = vid ? `${s.base}${vid}` : null;
              }
              break;

            case "ytify":
              if (list) {
                url = `${s.base}list?playlists=${list}`;
              } else if (vid) {
                url = `${s.base}?s=${vid}`;
              }
              break;

            case "auto":
              if (vid && list) {
                // 特別處理 Invidious 與 Hyperpipe：只要 playlist 連結
                if (["Invidious", "NYCHyperpipe", "CALHyperpipe", "POLHyperpipe"].includes(s.id)) {
                  url = `${s.base}playlist?list=${list}`;
                } else {
                  url = `${s.base}${s.type}?v=${vid}&list=${list}`;
                }
              } else if (vid) {
                url = `${s.base}${s.type}?v=${vid}`;
              } else if (list) {
                url = `${s.base}playlist?list=${list}`;
              }
              break;
          }

          const field = document.getElementById(s.id);
          const link = document.getElementById(s.linkId);

          if (url) {
            field.value = url;
            link.href = url;
            link.textContent = url;
            link.style.display = "inline";
          } else {
            field.value = "⚠️ 無法產生連結";
            link.style.display = "none";
          }
        });
      }
    </script>
  </body>
</html>
