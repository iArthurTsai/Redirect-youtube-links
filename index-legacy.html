<!doctype html>
<html>
  <head>
    <title>YouTube 轉換器</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: "Noto Sans TC", system-ui, sans-serif;
        padding: 1em;
      }
      input,
      button,
      textarea {
        width: 100%;
        font-size: 1rem;
        margin-top: 0.5em;
		resize: none; /* 隱藏右下角調整手柄，看起來更像 input */
		overflow: hidden; /* 防止出現滾動條影響視覺 */
      }
      .result-block {
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        margin-top: 1em;
      }
      .result-block label {
        font-weight: bold;
      }
      .result-block a {
        color: blue;
        text-decoration: underline;
      }
      /* 針對不支援 flex 的舊瀏覽器做簡單修正 */
      .result-block textarea {
        flex-basis: 100%;
        display: block;
        margin-top: 0.2em;
		width: 100%; /* 強制填滿 */
		box-sizing: border-box; /* 防止 padding 撐破寬度 */
      }
    </style>
  </head>
  <body>
    <h2>YouTube 轉換器</h2>
    <form onsubmit="convert(); return false;">
      <div class="result-block">
        <label>請貼上 YouTube/YouTube Music 連結：</label><br />
        <input id="yt" placeholder="https://www.youtube.com/watch?v=jNQXAC9IVRw" />
        <input type="submit" value="轉換" />
      </div>
    </form>

    <div id="results-container"></div>

    <hr />
    <div class="result-block">
      <p><strong>切換其他版本：</strong></p>
      <ul>
        <li><a href="index0.html">index0.html（只支援影片，相容舊瀏覽器）</a></li>
        <li><a href="index.html">index.html（功能完整但相容性較低）</a></li>
        <li><a href="index-legacy.html">index-legacy.html（功能完整，相容舊瀏覽器）</a></li>
      </ul>
    </div>

    <script>
      // 定義所有服務的設定
      var services = [
        {
          name: "youtube",
          label: "youtube 分享網址：",
          base: "https://yout-ube.com/",
          type: "watch",
          mode: "standard",
        },
        {
          name: "Invidious",
          label: "Invidious 分享網址：",
          base: "https://inv.nadeko.net/",
          type: "watch",
          mode: "standard",
        },
        {
          name: "PrivatecoffeePiped",
          label: "Piped 分享網址：",
          base: "https://piped.private.coffee/",
          type: "watch",
          mode: "standard",
        },
        {
          name: "wirewaychPiped",
          label: "Piped 分享網址：",
          base: "https://piped.wireway.ch/",
          type: "watch",
          mode: "standard",
        },

        // 隱藏的項目可以用 hidden: true 標記，或者直接註解掉
        {
          name: "NYCPiped",
          label: "Piped 分享網址：",
          base: "https://nyc1.pi.ggtyler.dev/",
          type: "watch",
          mode: "standard",
          hidden: true,
        },
        {
          name: "CALPiped",
          label: "Piped 分享網址：",
          base: "https://cal1.pi.ggtyler.dev/",
          type: "watch",
          mode: "standard",
          hidden: true,
        },
        {
          name: "POLPiped",
          label: "Piped 分享網址：",
          base: "https://pol1.pi.ggtyler.dev/",
          type: "watch",
          mode: "standard",
          hidden: true,
        },

        // mode: "vid_only_allow_param" 表示強制只抓 v，忽略 list 參數但用標準格式
		{
          name: "wirewaychRePiped",
          label: "RePiped 分享網址：",
          base: "https://repiped.wireway.ch/video.html?v=",
          mode: "vid_only",
        },
        {
          name: "wirewaychdevRePiped",
          label: "RePiped 分享網址：",
          base: "https://repiped-development-c7df8a.onwireway.online/video.html?v=",
          mode: "vid_only",
        },

        {
          name: "duckspartyHyperpipe",
          label: "Hyperpipe 分享網址：",
          base: "https://hyperpipe.ducks.party/",
          type: "watch",
          mode: "standard",
          hidden: true,
        },
        {
          name: "NYCHyperpipe",
          label: "Hyperpipe 分享網址：",
          base: "https://nyc1.hp.ggtyler.dev/",
          type: "watch",
          mode: "standard",
          hidden: true,
        },
        {
          name: "CALHyperpipe",
          label: "Hyperpipe 分享網址：",
          base: "https://cal1.hp.ggtyler.dev/",
          type: "watch",
          mode: "standard",
          hidden: true,
        },
        {
          name: "POLHyperpipe",
          label: "Hyperpipe 分享網址：",
          base: "https://pol1.hp.ggtyler.dev/",
          type: "watch",
          mode: "standard",
          hidden: true,
        },

        { name: "ytify", label: "ytify 分享網址：", base: "https://ytify.pp.ua/", mode: "ytify" },

        {
          name: "cinemaphile.com",
          label: "cinemaphile.com 分享網址：",
          base: "https://cinemaphile.com/watch?v=",
          mode: "vid_force",
        },

        { name: "YMusic", label: "YMusic 分享網址：", base: "https://ymusicapp.com/", type: "watch", mode: "standard" },
        {
          name: "m.gjhyss.com",
          label: "m.gjhyss.com 分享網址：",
          base: "https://m.gjhyss.com/share?v=",
          mode: "vid_only",
        },
        { name: "AstroTube", label: "AstroTube 分享網址：", base: "https://at.ggtyler.dev/watch?v=", mode: "vid_only" },
        { name: "shorturl", label: "最短 YouTube 連結：", base: "https://youtu.be/", mode: "short" },
        {
          name: "YTMusic",
          label: "YouTube Music 連結：",
          base: "https://music.youtube.com/",
          type: "watch",
          mode: "standard",
        },
      ];

      // 初始化 HTML 結構
      var container = document.getElementById("results-container");
      for (var i = 0; i < services.length; i++) {
        var s = services[i];
        var div = document.createElement("div");
        div.className = "result-block";
        if (s.hidden) div.style.display = "none";

        div.innerHTML =
          '<label style="display: inline;">' +
          s.label +
          "</label>" +
          '<a id="link_' +
          s.name +
          '" href="#" target="_blank" style="display: none;">點我前往</a>' +
          '<textarea id="text_' +
          s.name +
          '" rows="1" readonly></textarea>';
        container.appendChild(div);
      }

      function convert() {
        var input = document.getElementById("yt").value;
        var vidMatch = input.match(/(?:v=|\/)([0-9A-Za-z_-]{11})/);
        var listMatch = input.match(/[?&]list=([0-9A-Za-z_-]+)/);
        var vid = vidMatch ? vidMatch[1] : null;
        var list = listMatch ? listMatch[1] : null;

        for (var i = 0; i < services.length; i++) {
          var s = services[i];
          var url = "";
          var error = false;

          if (s.mode === "standard") {
            // 支援 v 和 list
            if (vid && list) url = s.base + s.type + "?v=" + vid + "&list=" + list;
            else if (vid) url = s.base + s.type + "?v=" + vid;
            else if (list) url = s.base + "playlist?list=" + list;
            else error = true;
          } else if (s.mode === "vid_only") {
            // 簡單接在後面，不支援 list
            if (vid) url = s.base + vid;
            else error = true;
          } else if (s.mode === "vid_force") {
            // 強制只用 v (像 cinemaphile)
            if (vid) url = s.base + vid;
            else error = true; // 有 list 無 vid 也算錯誤
          } else if (s.mode === "ytify") {
            if (list) url = s.base + "list?playlists=" + list;
            else if (vid) url = s.base + "?s=" + vid;
            else error = true;
          } else if (s.mode === "short") {
            if (vid && list) url = s.base + vid + "?list=" + list;
            else if (vid) url = s.base + vid;
            else if (list) url = "https://youtube.com/playlist?list=" + list;
            else error = true;
          }

          var textEl = document.getElementById("text_" + s.name);
          var linkEl = document.getElementById("link_" + s.name);

          if (error) {
            textEl.value = !vid && !list ? "⚠️ 無法辨識 ID" : "⚠️ 無法產生連結";
            linkEl.style.display = "none";
          } else {
            textEl.value = url;
            linkEl.href = url;
            linkEl.style.display = "inline";
            // 處理 IE8 innerText 相容性
            if ("textContent" in linkEl) {
              linkEl.textContent = url;
            } else {
              linkEl.innerText = url;
            }
          }
        }
      }
    </script>
  </body>
</html>
